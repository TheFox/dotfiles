#!/usr/bin/env bash

if [ -f "${HOME}/.gpg-agent-info" ]; then
	
	. "${HOME}/.gpg-agent-info"
	
	if [[ $(ps -p ${SSH_AGENT_PID} | wc -l) -le 1 ]]; then
		echo "no process with ID ${SSH_AGENT_PID} found"
		
		echo "start new gpg agent process"
		eval $(gpg-agent --daemon --enable-ssh-support --write-env-file "${HOME}/.gpg-agent-info")
	else
		echo "still running with ID ${SSH_AGENT_PID}"
	fi
else
	echo 'start gpg-agent'
	eval $(gpg-agent --daemon --enable-ssh-support --write-env-file "${HOME}/.gpg-agent-info")
fi
